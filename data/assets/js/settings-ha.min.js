document.addEventListener("DOMContentLoaded",init);let haSetField,haIpField,haPortField,haUserField,haPwdField,togglePwdBtn,pwdIcon,alertSaved,btnSave,isPwdVisible=!1;const savedToken=localStorage.getItem("token");async function init(){cacheElements(),bindEvents(),initView(),await loadSettings()}function cacheElements(){haSetField=document.getElementById("pref-ha"),haIpField=document.getElementById("pref-ha-ip"),haPortField=document.getElementById("pref-ha-port"),haUserField=document.getElementById("pref-ha-user"),haPwdField=document.getElementById("pref-ha-pwd"),togglePwdBtn=document.getElementById("btn-toggle-pwd"),pwdIcon=document.getElementById("pwd-icon"),alertSaved=document.getElementById("alert-saved-ha-settings"),btnSave=document.getElementById("btn-save")}function bindEvents(){togglePwdBtn.addEventListener("click",togglePasswordVisibility),btnSave.addEventListener("click",saveSettings),haSetField.addEventListener("change",toggleReadOnly)}function initView(){alertSaved.style.display="none",haPwdField.type="password",haSetField.value="false",haIpField.value="",haPortField.value="1883",haUserField.value="",haPwdField.value=""}async function loadSettings(){try{const e=await fetch("/api/settings/ha",{headers:{Authorization:savedToken}});if(!e.ok)throw new Error(`Load failed: ${e.status}`);const t=await e.json();haSetField.checked=Boolean(t.activate),haIpField.value=t.ip||"1883",haPortField.value=t.port||"",haUserField.value=t.user||"",haPwdField.value=t.pwd||"",toggleReadOnly()}catch(e){console.error("Error loading HA settings:",e)}}function togglePasswordVisibility(){isPwdVisible?(haPwdField.type="password",pwdIcon.src="../assets/img/eye.svg"):(haPwdField.type="text",pwdIcon.src="../assets/img/eye-slash.svg"),isPwdVisible=!isPwdVisible}function toggleReadOnly(){const e=haSetField.checked;haIpField.readOnly=!e,haPortField.readOnly=!e,haUserField.readOnly=!e,haPwdField.readOnly=!e}async function saveSettings(e){e.preventDefault();try{const e=await fetch("/api/settings/ha",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:savedToken},body:new URLSearchParams({activate:haSetField.checked?"true":"false",ip:haIpField.value,port:haPortField.value,user:haUserField.value,pwd:haPwdField.value})});if(!e.ok)throw new Error(`HTTP ${e.status}`);showSavedAlert()}catch(e){console.error("Error saving details:",e)}}function showSavedAlert(){alertSaved.style.display="block",scrollToTop(),setTimeout((()=>{alertSaved.style.display="none"}),3e3)}function scrollToTop(){window.scrollTo({top:0,behavior:"smooth"})}