let alertSavedSecurity,useAuthField,securityContainer,adminPwdField,saveBtn,togglePwdBtn,pwdIcon;document.addEventListener("DOMContentLoaded",init);let isPwdVisible=!1;const savedToken=localStorage.getItem("token");async function init(){cacheElements(),bindEvents(),await loadSettings()}function cacheElements(){alertSavedSecurity=document.getElementById("alert-saved-security"),securityContainer=document.getElementById("security-container"),useAuthField=document.getElementById("pref-use-auth"),adminPwdField=document.getElementById("pref-main-pwd"),saveBtn=document.getElementById("btn-save"),togglePwdBtn=document.getElementById("btn-toggle-pwd"),pwdIcon=document.getElementById("pwd-icon"),alertSavedSecurity.style.display="none",adminPwdField.type="password"}function bindEvents(){togglePwdBtn.addEventListener("click",togglePasswordVisibility),saveBtn.addEventListener("click",handleSave),useAuthField.addEventListener("change",(e=>{securityContainer.style.display=e.target.checked?"block":"none"}))}async function loadSettings(){try{const e=await fetch("/api/settings/security",{headers:{Authorization:savedToken}});if(!e.ok)throw new Error(`Load failed: ${e.status}`);const t=await e.json();useAuthField.checked=Boolean(t.useAuth),securityContainer.style.display=useAuthField.checked?"block":"none",adminPwdField.value=t.pwd||""}catch(e){console.error("Error loading security settings:",e)}}function togglePasswordVisibility(){isPwdVisible?(adminPwdField.type="password",pwdIcon.src="../assets/img/eye.svg"):(adminPwdField.type="text",pwdIcon.src="../assets/img/eye-slash.svg"),isPwdVisible=!isPwdVisible}async function handleSave(e){if(e.preventDefault(),useAuthField.checked&&!adminPwdField.value)return;const t=new URLSearchParams({pwd:adminPwdField.value,useAuth:useAuthField.checked?"true":"false"});try{const e=await fetch("/api/settings/security",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:savedToken},body:t});if(!e.ok)return console.error(`Save failed: ${e.status}`),void(adminPwdField.value="");showSavedAlert()}catch(e){console.error("Error saving security settings:",e)}}function showSavedAlert(){alertSavedSecurity.style.display="block",scrollToTop(),setTimeout((()=>{alertSavedSecurity.style.display="none"}),3e3)}function scrollToTop(){window.scrollTo({top:0,behavior:"smooth"})}